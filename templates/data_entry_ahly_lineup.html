{% extends "base.html" %}

{% block title %}Ahly Lineup - Match Data Manager{% endblock %}

{% block content %}
<!-- Ahly Lineup specific scripts -->
<form id="ahly-lineup" method="POST" action="/save_data">
    <input type="hidden" name="data_type" value="ahly_lineup">
    
    <!-- Match Information -->
    <div class="form-grid three-columns">
        <div class="form-group">
            <label>Match Date <span style="color: red;">*</span></label>
            <input type="date" name="match_date" required>
            <small style="color: #666;">You must enter the match date to save data</small>
        </div>
        <div class="form-group">
            <label>Match ID</label>
            <input type="text" name="match_id" placeholder="Match ID" required>
        </div>
        <div class="form-group">
            <label>Target Sheet <span style="color: red;">*</span></label>
            <select name="target_sheet" id="target_sheet" required>
                <option value="">Select Sheet (Required)</option>
                <option value="CLAM">CLAM</option>
                <option value="ALAM">ALAM</option>
                <option value="CCAM">CCAM</option>
                <option value="SCAM">SCAM</option>
                <option value="CWCAM">CWCAM</option>
                <option value="WCAM">WCAM</option>
                <option value="EGYAM">EGYAM</option>
            </select>
            <small style="color: #666;">You must select a target sheet to save data</small>
        </div>
    </div>

    <div class="players-grid" style="margin-top: 20px;">
        <!-- Headers -->
        <div class="player-header">
            <div class="header-cell">MINMAT</div>
            <div class="header-cell">Player Name</div>
            <div class="header-cell">Status</div>
            <div class="header-cell">Player Out</div>
            <div class="header-cell">Min Out</div>
            <div class="header-cell">Min Total</div>
            <div class="header-cell">Action</div>
        </div>
        
        <!-- Player Rows Container -->
        <div id="players-container">
            <!-- 16 Player rows will be created here -->
        </div>
    </div>
    
    <!-- Player Management Buttons -->
    <div class="form-actions" style="margin-top: 20px;">
        <button type="button" class="btn btn-secondary" onclick="addPlayerRow()">Add Player</button>
        <button type="button" class="btn btn-secondary" onclick="clearAllPlayers()">Clear All</button>
    </div>

    <!-- Form Actions -->
    <div class="form-actions">
        <button type="button" class="btn btn-secondary" onclick="resetCurrentForm()">Reset Form</button>
        <button type="button" class="btn btn-secondary" onclick="exportCurrentData()">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
            </svg>
            Export to Excel
        </button>
        <button type="button" id="save-btn" class="btn btn-primary" onclick="validateAndSave()" disabled>
            <svg class="icon icon-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                <polyline points="17 21 17 13 7 13 7 21"/>
                <polyline points="7 3 7 8 15 8"/>
            </svg>
            <span id="save-btn-text">Save to Google Sheets</span>
        </button>
    </div>
</form>
{% endblock %}

{% block scripts %}
<script>
    // Initialize players when the page loads
    document.addEventListener('DOMContentLoaded', function() {
        // Always initialize 16 players on page load
        initializePlayers();
        
        // Add validation for required fields
        addValidationListeners();
    });
    
    function addValidationListeners() {
        const targetSheetSelect = document.getElementById('target_sheet');
        const matchDateInput = document.querySelector('input[name="match_date"]');
        const saveButton = document.querySelector('button[onclick="validateAndSave()"]');
        
        // Validate on input change
        targetSheetSelect.addEventListener('change', validateRequiredFields);
        matchDateInput.addEventListener('change', validateRequiredFields);
        
        // Initial validation
        validateRequiredFields();
    }
    
    function validateRequiredFields() {
        const targetSheetSelect = document.getElementById('target_sheet');
        const matchDateInput = document.querySelector('input[name="match_date"]');
        const saveButton = document.querySelector('button[onclick="validateAndSave()"]');
        
        const isTargetSheetSelected = targetSheetSelect.value !== '';
        const isDateEntered = matchDateInput.value !== '';
        
        // Enable/disable save button based on validation
        if (saveButton) {
            if (isTargetSheetSelected && isDateEntered) {
                saveButton.disabled = false;
                saveButton.style.opacity = '1';
                saveButton.style.cursor = 'pointer';
            } else {
                saveButton.disabled = true;
                saveButton.style.opacity = '0.5';
                saveButton.style.cursor = 'not-allowed';
            }
        }
        
        // Add visual indicators
        if (targetSheetSelect) {
            if (isTargetSheetSelected) {
                targetSheetSelect.style.borderColor = '#28a745';
            } else {
                targetSheetSelect.style.borderColor = '#dc3545';
            }
        }
        
        if (matchDateInput) {
            if (isDateEntered) {
                matchDateInput.style.borderColor = '#28a745';
            } else {
                matchDateInput.style.borderColor = '#dc3545';
            }
        }
    }
    
    // Override saveCurrentForm to add additional validation
    function validateAndSave() {
        const targetSheetSelect = document.getElementById('target_sheet');
        const matchDateInput = document.querySelector('input[name="match_date"]');
        
        if (!targetSheetSelect.value) {
            alert('Please select a Target Sheet from the dropdown list.');
            targetSheetSelect.focus();
            return false;
        }
        
        if (!matchDateInput.value) {
            alert('Please enter the Match Date.');
            matchDateInput.focus();
            return false;
        }
        
        // If validation passes, proceed with save
        return saveCurrentForm();
    }
</script>
{% endblock %}

